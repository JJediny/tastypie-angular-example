addEvent(window,'load',reorder_init);var lis;var top=0;var left=0;var height=30;function reorder_init(){lis=document.getElementsBySelector('ul#orderthese li');var input=document.getElementsBySelector('input[name=order_]')[0];setOrder(input.value.split(','));input.disabled=true;draw();var limit=(lis.length-1)*height;for(var i=0;i<lis.length;i++){var li=lis[i];var img=document.getElementById('handle'+li.id);li.style.zIndex=1;Drag.init(img,li,left+10,left+10,top+10,top+10+limit);li.onDragStart=startDrag;li.onDragEnd=endDrag;img.style.cursor='move';}}
function submitOrderForm(){var inputOrder=document.getElementsBySelector('input[name=order_]')[0];inputOrder.value=getOrder();inputOrder.disabled=false;}
function startDrag(){this.style.zIndex='10';this.className='dragging';}
function endDrag(x,y){this.style.zIndex='1';this.className='';var oldIndex=this.index;var newIndex=Math.round((y-10-top)/height);this.style.top=(10+top+newIndex*height)+'px';this.index=newIndex;moveItem(oldIndex,newIndex);}
function moveItem(oldIndex,newIndex){if(oldIndex==newIndex){return;}
var direction,lo,hi;if(newIndex>oldIndex){lo=oldIndex;hi=newIndex;direction=-1;}else{direction=1;hi=oldIndex;lo=newIndex;}
var lis2=new Array();for(var i=0;i<lis.length;i++){if(i<lo||i>hi){lis2[i]=lis[i];continue;}else if(i==newIndex){lis2[i]=lis[oldIndex];continue;}else{lis2[i]=lis[i-direction];}}
reIndex(lis2);lis=lis2;draw();document.getElementsBySelector('input[name=order_]')[0].value=getOrder();}
function reIndex(lis){for(var i=0;i<lis.length;i++){lis[i].index=i;}}
function draw(){for(var i=0;i<lis.length;i++){var li=lis[i];li.index=i;li.style.position='absolute';li.style.left=(10+left)+'px';li.style.top=(10+top+(i*height))+'px';}}
function getOrder(){var order=new Array(lis.length);for(var i=0;i<lis.length;i++){order[i]=lis[i].id.substring(1,100);}
return order.join(',');}
function setOrder(id_list){var temp_lis=new Array();for(var i=0;i<id_list.length;i++){var id='p'+id_list[i];temp_lis[temp_lis.length]=document.getElementById(id);}
reIndex(temp_lis);lis=temp_lis;draw();}
function addEvent(elm,evType,fn,useCapture)
{if(elm.addEventListener){elm.addEventListener(evType,fn,useCapture);return true;}else if(elm.attachEvent){var r=elm.attachEvent("on"+evType,fn);return r;}else{elm['on'+evType]=fn;}}